var Q=function(){};Q.prototype.then=function(c){this.data?c(data):this.cb=c};Q.prototype.resolve=function(c){this.cb?this.cb(c):this.data=c};Q.prototype.reject=function(c){this.err&&this.err(c)};Q.all=function(c){var e=c.length,g=0,n=new Q;c.forEach(function(c){c.then(function(){g+=1;g===e&&n.resolve()})});return n};
var load=function(c){var e=new XMLHttpRequest,g=new Q;e.open("GET","/chapters/"+c+".html");e.onreadystatechange=function(){4===e.readyState&&(200===e.status?(gmtr.emit("loaded",{name:c,loaded:1,total:1}),g.resolve(e.responseText)):g.reject("Could not load data."))};e.onprogress=function(e){gmtr.emit("loaded",{name:c,loaded:e.loaded,total:e.total})};e.send();return g};
DC.ready(function(){function c(a,f,t){if(a){if("object"===typeof a){var c=a;a=a.page}else c=d.getPage(a);var g=k[a]||DC({c:"chapter"}),h=new Q;k[a]?(l=a,t||e(k[a],a,f),h.resolve()):load(a).then(function(b){l=a;g.h=b||'<div class="chapter-title">'+c.title+"</div>";t?k[a]=g:e(g,a,f);h.resolve()});b.activate(l);return h}}function e(a,b,c){k[b]=a;var f=d.getPage(d.getPrev(b));f&&(f=k[f.page]);f?a.after(f):((f=d.getPage(d.getNext(b)))&&(f=k[f.page]),f?a.before(f):a.into(q));c||(g(),window.scrollTo(0,a.offsetTop-
80))}function g(a){a&&l!==a&&(l=a,b.activate(l));localStorage.setItem("chapter",l)}var n=DC({c:"body"}).into(document.body),q=DC({c:"view"}).into(n),m=DC({c:"controls center"}).into(n),d=[{title:"UABRO - age of intelligent freedom",page:"cover-page"},{title:"Introduction",page:"introduction"},{title:"Intelligent freedom",page:"intelligent-freedom"},{title:"Finale of development",page:"finale-of-development"},{title:"Chaos and order",page:"chaos-and-order"},{title:"Four ways of behavior",page:"four-ways-of-behavior"},
{title:"Priority project",page:"priority-project"},{title:"True or simulation",page:"true-or-simulation"},{title:"Ecosystem",page:"ecosystem"},{title:"Focus on",page:"focus-on"},{title:"Infinite beauty of consciousness",page:"infinite-beauty-of-consciousness"},{title:"Not conclusion",page:"not-conclusion"},{title:"Vocabulary",page:"vocabulary"}];d.getIndex=function(a){for(var f=d.length,b=0;b<f;b+=1)if(d[b].page===a)return b};d.getNext=function(a){a=d.getIndex(a);if(!1!==a&&a!==d.length-1)return d[a+
1]};d.getPrev=function(a){a=d.getIndex(a);if(!1!==a&&0!==a)return d[a-1]};d.getPage=function(a){if(a)return"object"===typeof a&&(a=a.page),d.find(function(b){return b.page===a})};var k={},l,h=!1,b=DC({c:"content"});b.render=function(){b.classList.contains("visible-x")?b._hide():(b.addClass("visible-x"),document.body.addClass("no-scroll"),b.scrollTo(0,0))};b._hide=function(){b.removeClass("visible-x");document.body.removeClass("no-scroll")};b.chapters=[];n=DC({c:"content-close-wrap"}).into(b);DC({c:"content-close",
t:"hide",events:{click:function(){b._hide()}}}).into(n);d.forEach(function(a){b.chapters[a.page]=DC("button",{t:a.title,events:{click:function(){c(a.page);h=window.pageYOffset}}}).into(b)});DC({c:"right",h:"<i>by Oleksii Shnyra</i>"}).into(b);b.activate=function(a){b.chapters[a]&&(b.curChapter&&b.curChapter.removeClass("active"),b.curChapter=b.chapters[a],b.curChapter.addClass("active"),u.t=b.curChapter.t,b._hide())};var u=DC("button",{t:"content",c:"title",events:{click:function(){b.render()}},prevented:["click"]});
m.list([u,b]);var v=function(){p.length=0;DC.iterObj(k,function(a,b){p.push({top:b.offsetTop,page:a})});p.sortBy("top");for(var a=window.pageYOffset,b,c,d=p.length-1;d;--d){var e=p[d];if(e.top<a+100){b=e;c=!0;break}}c||(b=p[0]);b&&l!==b.page&&g(b.page)},w=!1;m.hide();var x=DC({c:"load-animation"}).into(q);x.css({width:0});var r={},y=d.length;gmtr.on("loaded",function(a){r[a.name]||(r[a.name]={});var b=r[a.name];b.loaded=a.loaded;b.total=a.total;var c=0;DC.iterObj(r,function(a,b){c+=b.loaded/b.total});
c*=100/y;x.css({width:c+"%"})});var z=Date.now();Q.all(d.map(function(a){return c(a.page,!0,!0)})).then(function(){w=!0;var a=Date.now()-z;setTimeout(function(){q.clear();d.forEach(function(a){return k[a.page].into(q)});m.show();var a=localStorage.getItem("top");c(localStorage.getItem("chapter")||d[0]);"string"===typeof a&&window.scrollTo(0,a);h=a-m.offsetHeight;m.css({top:h});v()},1256>a?1256-a:0)});var p=[];DC.onwindow("scroll",function(){var a=window.pageYOffset;w&&(localStorage.setItem("top",
a),setTimeout(v));if(!1===h)h=a;else{var b=m.offsetHeight,c=h-a;a>h?(c<-b&&(c=-b,h=a-b),m.css({top:c/3+"%"})):c&&(h=a,m.css({top:0}))}})});