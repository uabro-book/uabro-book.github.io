var Q=function(){};Q.prototype.then=function(b){this.data?b(data):this.cb=b};Q.prototype.resolve=function(b){this.cb?this.cb(b):this.data=b};Q.prototype.reject=function(b){this.err&&this.err(b)};Q.all=function(b){var e=b.length,f=0,p=new Q;b.forEach(function(b){b.then(function(){f+=1;f===e&&p.resolve()})});return p};
var load=function(b){var e=new XMLHttpRequest,f=new Q;e.open("GET","/chapters/"+b+".html");e.onreadystatechange=function(){4===e.readyState&&(200===e.status?(gmtr.emit("loaded",{name:b,loaded:1,total:1}),f.resolve(e.responseText)):f.reject("Could not load data."))};e.onprogress=function(e){gmtr.emit("loaded",{name:b,loaded:e.loaded,total:e.total})};e.send();return f};
DC.ready(function(){function b(a,m,t){if(a){if("object"===typeof a){var b=a;a=a.page}else b=d.getPage(a);var f=h[a]||DC({c:"chapter"}),g=new Q;h[a]?(k=a,t||e(h[a],a,m),g.resolve()):load(a).then(function(c){k=a;f.h=c||'<div class="chapter-title">'+b.title+"</div>";t?h[a]=f:e(f,a,m);g.resolve()});c.activate(k);return g}}function e(a,m,c){h[m]=a;var b=d.getPage(d.getPrev(m));b&&(b=h[b.page]);b?a.after(b):((b=d.getPage(d.getNext(m)))&&(b=h[b.page]),b?a.before(b):a.into(q));c||(f(),window.scrollTo(0,a.offsetTop-
80))}function f(a){a&&k!==a&&(k=a,c.activate(k));localStorage.setItem("chapter",k)}var p=DC({c:"body"}).into(document.body),q=DC({c:"view"}).into(p),g=DC({c:"controls center"}).into(p),d=[{title:"UABRO - age of intelligent freedom",page:"cover-page"},{title:"Introduction",page:"introduction"},{title:"Intelligent freedom",page:"intelligent-freedom"},{title:"Finale of development",page:"finale-of-development"},{title:"Chaos and order",page:"chaos-and-order"},{title:"Four ways of behavior",page:"four-ways-of-behavior"},
{title:"Priority project",page:"priority-project"},{title:"True or simulation",page:"true-or-simulation"},{title:"Ecosystem",page:"ecosystem"},{title:"Focus on",page:"focus-on"},{title:"Infinite beauty of consciousness",page:"infinite-beauty-of-consciousness"},{title:"Not conclusion",page:"not-conclusion"},{title:"Vocabulary",page:"vocabulary"}];d.getIndex=function(a){for(var b=d.length,c=0;c<b;c+=1)if(d[c].page===a)return c};d.getNext=function(a){a=d.getIndex(a);if(!1!==a&&a!==d.length-1)return d[a+
1]};d.getPrev=function(a){a=d.getIndex(a);if(!1!==a&&0!==a)return d[a-1]};d.getPage=function(a){if(a)return"object"===typeof a&&(a=a.page),d.find(function(b){return b.page===a})};var h={},k,l=!1,c=DC({c:"content"}).hide();c.render=function(){"none"===c.style.display?(c.show(),document.body.addClass("no-scroll")):c._hide()};c._hide=function(){c.hide();document.body.removeClass("no-scroll")};c.chapters=[];d.forEach(function(a){c.chapters[a.page]=DC("button",{t:a.title,events:{click:function(){b(a.page);
c.activate(a.page)}}}).into(c)});c.activate=function(a){c.chapters[a]&&(c.curChapter&&c.curChapter.removeClass("active"),c.curChapter=c.chapters[a],c.curChapter.addClass("active"),u.t=c.curChapter.t,c._hide())};var u=DC("button",{t:"content",c:"title",events:{click:function(){c.render()}},prevented:["click"]});g.list([u,c]);var v=function(){n.length=0;DC.iterObj(h,function(a,b){n.push({top:b.offsetTop,page:a})});n.sortBy("top");for(var a=window.pageYOffset,b,c,d=n.length-1;d;--d){var e=n[d];if(e.top<
a+100){b=e;c=!0;break}}c||(b=n[0]);b&&k!==b.page&&f(b.page)},w=!1;g.hide();var x=DC({c:"load-animation"}).into(q);x.css({width:0});var r={},y=d.length;gmtr.on("loaded",function(a){r[a.name]||(r[a.name]={});var b=r[a.name];b.loaded=a.loaded;b.total=a.total;var c=0;DC.iterObj(r,function(a,b){c+=b.loaded/b.total});c*=100/y;x.css({width:c+"%"})});var z=Date.now();Q.all(d.map(function(a){return b(a.page,!0,!0)})).then(function(){w=!0;var a=Date.now()-z;setTimeout(function(){q.clear();d.forEach(function(a){return h[a.page].into(q)});
g.show();var a=localStorage.getItem("top");b(localStorage.getItem("chapter")||d[0]);"string"===typeof a&&window.scrollTo(0,a);l=a-g.offsetHeight;g.css({top:l});v()},1256>a?1256-a:0)});var n=[];DC.onwindow("scroll",function(){var a=window.pageYOffset;w&&(localStorage.setItem("top",a),setTimeout(v));if(!1===l)l=a;else{var b=g.offsetHeight,c=l-a;a>l?(c<-b&&(c=-b,l=a-b),g.css({top:c/3+"%"})):c&&(l=a,g.css({top:0}))}})});